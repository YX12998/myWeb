<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>dom-3</title>
		<style type="text/css">
			.body {
				width: 100%;
				height: 100%;
				/* position: relative; */
			}

			.longStick {
				width: 300px;
				height: 130px;
				/* 				background-color: cadetblue; */
				background-image: url(乔治.png);
				background-repeat: no-repeat;
				background-size: 60%;
				background-position-y: -30px;
				background-position-x: 100px;

				position: absolute;
				left: 5%;
				top: 50%;
			}
		</style>
	</head>
	<body>
		<div class="longStick" id="stick1">

		</div>

	</body>
</html>
<script>
	//1.1 鼠标事件
	// document.body.onmousedown = function(e){
	// 	console.info(1);
	// }
	// 
	// document.body.onclick = function(){
	// 	console.info(2);
	// }

	document.getElementById("stick1").onmousedown = function(e) {
		// onmousemove 事件驻车
		e.target.onmousemove = function(e) {
			setBomAngle(e);
		}
	}
	document.getElementById("stick1").onmouseup = function(e) {
		console.info("停止监听");
		e.target.onmousemove = null; // 事件解绑
	}
	// 容错 onmouseout 
	document.getElementById("stick1").onmouseout = function(e) {
		console.info("停止监听");
		e.target.onmousemove = null;
	}

	// 监听键盘
	// 在这里补充些按键类型和shift 组合按键, 
	// 参考http://www.w3school.com.cn/example/hdom_examples.asp
	document.body.onkeypress = function(e) {
		console.info(e.key);

	}

	//var y = 0;

	function setBomAngle(e) {
		console.info("监听鼠标移动事件");
		// if( e.movementX <0 ){
		// 	console.info( "左移 <------")
		// }else{
		// 	console.info( "向右移 --->")
		// }

		// if( e.movementY <0 ){
		// 	console.info( "上移 ^^^^^^");
		// 
		// 	y -= 5;
		// 	var p = y + "deg";
		// 	document.getElementById("stick1").style.transform = "rotate(" + p + ")";
		// }else{
		// 	console.info( "下移 ``");
		// 	
		// 	y += 5;
		// 	var p = y + "deg";
		// 	document.getElementById("stick1").style.transform = "rotate(" + p + ")";
		// }

		var currAngle = document.getElementById("stick1").style.transform;
		if (!currAngle) {
			currAngle = 0;
		} else {
			currAngle = currAngle.replace("rotate(", "");
			currAngle = currAngle.replace("deg)", "");
			currAngle = parseInt(currAngle);
		}

		if (e.movementY < 0) {
			currAngle -= 1;
		} else {
			currAngle += 1;
		}

		if (currAngle > -30 && currAngle < 0) {
			document.getElementById("stick1").style.transform = "rotate(" + currAngle + "deg)";
		}

		// 获取当前角度
		// 判断鼠标是向上还是向下
		// 旋转动作
		// transform: rotate(7 deg); -
		// ms - transform: rotate(7 deg); /* IE 9 */ -
		// moz - transform: rotate(7 deg); /* Firefox */ -
		// webkit - transform: rotate(7 deg); /* Safari 和 Chrome */ -
		// o - transform: rotate(7 deg); /* Opera */
		// 不能有空格
		// document.getElementById("stick1").style.transform = 'rotate(70deg)';
	}
	
	//滚轮调整炮口
	window.onmousewheel = function(e){
		console.info(e);
		//WheelEvent.deltaX: 滚轮水平滚动量
		//WheelEvent.deltaY: 滚轮垂直滚动量
		//WheelEvent.deltaZ: 滚轮z滚动量
		//WheelEvent.deltaMode: 滚轮水平滚动量  0是像素, 1是行 ,2是页
		// e.shiftKey 为true表示按住了shift键
		
		var currAngle = document.getElementById("stick1").style.transform;
		if (!currAngle) {
			currAngle = 0;
		} else {
			currAngle = currAngle.replace("rotate(", "");
			currAngle = currAngle.replace("deg)", "");
			currAngle = parseInt(currAngle);
		}
		
		if( e.shiftKey ){
			if( e.deltaY < 0 ){
				console.info("向上移动");
				currAngle -= 1;
			}else{
				console.info("向下移动");
				currAngle += 1;
			}
		}
		
		if( currAngle > -30 && currAngle < 0 ){
			document.getElementById("stick1").style.transform = "rotate(" + currAngle + "deg)";

		}
	}
</script>
